import * as grpc from "@grpc/grpc-js";

// These types are generated by ts-proto into src/gen based on protos/api/api.proto
// We import from the path ts-proto will emit for protos/api/api.proto
// When protos are vendored and codegen is run, this import will resolve.
// eslint-disable-next-line import/no-relative-packages
import { WalletClient, WalletSolidityClient } from "./gen/api/api.js";

export interface TronClientOptions {
  /** Force insecure connection (no TLS). Useful for localhost or providers that expose plaintext gRPC. */
  insecure?: boolean;
}

export function createTronClients(host: string, apiKey?: string, opts: TronClientOptions = {}) {
  const creds =
    opts.insecure || /^(localhost|127\.0\.0\.1)/.test(host)
      ? grpc.credentials.createInsecure()
      : grpc.credentials.createSsl();
  const meta = new grpc.Metadata();
  if (apiKey) meta.add("TRON-PRO-API-KEY", apiKey);
  const callOpts = { metadata: meta } as const;

  const wallet = new WalletClient(host, creds);
  const solidity = new WalletSolidityClient(host, creds);

  return { wallet, solidity, callOpts };
}

// Re-export generated types/services for consumers
export * from "./gen/api/api.js";
